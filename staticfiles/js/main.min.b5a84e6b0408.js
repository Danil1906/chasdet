$(document).ready((function(){$(".burger_button").on("click",(function(){"-330px"==$(".category_dynamic_block").css("left")?($(".category_dynamic_block").animate({left:"0px"}),$(".burger-muted-background").addClass("muted-background-burger")):($(".category_dynamic_block").animate({left:"-330px"}),$(".burger-muted-background").removeClass("muted-background-burger"))})),$(document).click((function(e){var t=$(".category_dynamic_block"),n=t.css("left");t.is(e.target)||"0px"!=n||($(".category_dynamic_block").animate({left:"-330px"}),$(".burger-muted-background").removeClass("muted-background-burger"))})),document.querySelectorAll(".li_for_root_leaf").forEach((function(e){e.addEventListener("mouseover",(function(){let e=$(this).position();console.log(e),$(this).find(".children").attr("style","display: block"),$(this).find(".children").css("top",e.top-20+"px")})),e.addEventListener("mouseout",(function(){$(this).find(".children").attr("style","display: none")}))})),document.querySelectorAll(".prod-card-div").forEach((function(e){let t=$(e).find("#quantity-from-cart")[0],n=($(e).find(".variable-quantity-p")[0],$(e).find(".variable-quantity")[0]),i=Number($(n).text()),l=$(e).find(".quantity-input"),o=i-Number($(t).text()),c=$(e).find(" a.quantity-arrow-minus"),r=$(e).find(".quantity-arrow-plus"),a=$(e).find("#basket-form");$(n).text(o),$(l).attr("max",o),$(l).bind("input",(function(){$(n).text(o-$(this).val())})),$(c).on("click",(function(){let e=Number($(l).val());e>1&&$(l).trigger("input",$(l).val(e-1))})),$(r).on("click",(function(){let e=Number($(l).val());e<Number(i)&&$(l).trigger("input",$(l).val(e+1))})),$(a).submit((function(t){t.preventDefault();const l=$(this);$.post(l.attr("action"),l.serialize()).done((function(t){let l=t.count;$("#count-items").text(l);let c=$(e).find("#id_quantity");$(c).val(""),o=Number($(n).text()),i=Number($(n).text())}))}))}));let e=$("#finel-price"),t=$(e).find("#an_order_btn")[0];const n=$(e).find("form");$(t).on("click",(function(e){$.post($(t).attr("href"),n.serialize()).done((function(e){console.log("Готово")}))})),document.querySelectorAll("#item-cart-in-cart").forEach((function(e){e.querySelector(".remove-item-cart").addEventListener("click",(function(t){t.preventDefault();let n=$(this).attr("href");$.ajax({url:n,method:"get",dataType:"json",success:function(t){let n=t.count,i=t.total_price;$("#count-items").text(n);let l=$("#finel-price").find(".total-price").text().split(" ")[0]+" "+i;$("#finel-price").find(".total-price").text(l),$(e).hide("fast",(function(){$(this).remove()}))}})}))})),$("#btn-in").on("click",(function(e){e.preventDefault();let t=$(window).height(),n=$(".muted-background-login-block");$(".login_block").css("top",t/2/2),$(".login_block").css("display","block"),$(n).css("height",t),$(n).css("display","block"),$(".login_block").hide(),$(n).hide(),$(".login_block").show("fast"),$(n).show("fast")})),$(document).on("click",(function(e){let t=$(".muted-background-login-block"),n=$(".login_block"),i=$("#btn-in");"none"!=$(n).css("display")&&0===n.has(e.target).length&&0===i.has(e.target).length&&($(".login_block").hide("fast"),$(t).hide("fast"))}));let i=document.querySelector("#login-form-main");$(i).submit((function(e){e.preventDefault();const t=$(this),n=$.post(t.attr("action"),t.serialize());n.done((function(e){let t=$(".muted-background-login-block");$("#btn-ex").css("display","block"),$("#profile-btn").css("display","block"),$("#btn-in").css("display","none"),$("#btn-reg").css("display","none"),$(t).hide("fast"),document.querySelector(".login_block").querySelectorAll("input.form-control").forEach((function(e){$(e).val("")})),$(".login_block").attr("hidden","hidden"),location.reload()})),n.fail((function(e){$(".it-if-error").css("display","block")}))})),$("#checkMe").is(":checked")&&console.log("Выбрано"),$("#main-check-cart").on("click",(function(e){let t=document.querySelectorAll("#check-in-card");$(this).is(":checked")?t.forEach((function(e){$(e).is(":checked")||$(e).trigger("click")})):t.forEach((function(e){$(e).trigger("click"),$(e).is(":checked")&&$(e).trigger("click")}))})),$("#del-all-selected").on("click",(function(e){e.preventDefault();let t="",n=$(this).attr("href"),i=document.querySelectorAll("#check-in-card:checked");i.length>0&&(i.forEach((function(e){let n=$(e).parents("#item-cart-in-cart")[0],i=$(n).find(".remove-item-cart");i=$(i).attr("href"),i=i.split("/"),i=i[i.length-2],i=String(i),t+=i,t+="-"})),n=n.substr(0,n.length-3)+t,n=n.substr(0,n.length-1),$.ajax({url:n,method:"get",dataType:"json",success:function(e){console.log("Успешное удаление"),$("#main-check-cart").is(":checked")&&(console.log("Почему то сработало"),$("#main-check-cart").trigger("click"));let t=e.count,n=e.total_price;$("#count-items").text(t);let l=$("#finel-price").find(".total-price").text().split(" ")[0]+" "+n;$("#finel-price").find(".total-price").text(l),i.forEach((function(e){let t=$(e).parents("#item-cart-in-cart")[0];$(t).hide("fast",(function(){$(this).remove()}))}))}}))}));let l=document.querySelectorAll("#item-cart-in-cart"),o=0;l.forEach((function(e){let t=$(e).find("#quantity-update-form")[0],n=$(t).find("form").find("#quantity-update"),i=$(t).find(".quantity-input")[0],l=$(e).find("form").find("p[hidden]")[0],c=$(t).find("#quantity-for-clients")[0],r=$(c).find("p[hidden]")[0],a=$(c).find("span")[0],s=$($(".total-price")[0]).text();s=s.split(" ");let d=s[0],u=$(a).css("color"),f=$(e).find(".item_total_price").find("span"),p=$($(t).find(".price-per-unit")[0]).text(),m=$(e).find(" a.quantity-arrow-minus"),b=$(e).find(".quantity-arrow-plus");p=Number(p.replace(",",".")),$(a).text($(r).text()-$(l).text()),o+=p*Number($(i).val()),Number($(l).text())>Number($(r).text())&&($(c).text("Указано больше, чем доступно на данный момент. Всего доступно "+$(r).text()),$(c).css("color","red")),$(i).val($(l).text());let h=Number((Number($(i).val())*p).toFixed(2));o+=h,$(i).keydown((function(e){13===e.keyCode&&e.preventDefault()})),$(i).attr("max",$(r).text()),$(m).on("click",(function(){let e=Number($(i).val());e>1&&$(i).trigger("input",$(i).val(e-1))})),$(b).on("click",(function(){let e=Number($(i).val());e<Number($(r).text())&&$(i).trigger("input",$(i).val(e+1))})),$(i).bind("input",(function(){Number($(this).val())<=Number($(r).text())?(o-=h,h=Number((Number($(this).val())*p).toFixed(2)),o+=h,o=o.toFixed(2),$(f).text(String(h)),$(".total-price").text(d+" "+o.replace(".",",")),$(),$(c).text("еще доступно: "+($(r).text()-$(i).val())),$(c).css("color",u),$(n).val("True"),setTimeout((function(){let t=$(e).find("form"),n=$(t).attr("action");const i=$.post(n,$(t).serialize());i.done((function(){})),i.fail((function(){}))}),500)):($(c).text("Вы пытайтесь ввести больше чем доступно. Всего доступно "+$(r).text()),$(c).css("color","red"),setTimeout((function(){$(a).attr("style","color:"+u)}),2500))}))}));let c=$("#changeable-js-block")[0],r=$("#index-input")[0],a=$(r).css("border"),s=$("#changeable-js-block").find("label")[0],d=$(s).text(),u=$("#input-delivery-btn")[0],f=$("#s-changeable-js-block");function p(e,t,n,i){let l=12;t.features.length>100&&(console.log("Изменение стартового масштаба карты в связи с большим пакем объектов"),l=9),ymaps.ready((function(){var e=new ymaps.Map("map",{center:[t.features[0].geometry.coordinates[0],t.features[0].geometry.coordinates[1]],zoom:l},{searchControlProvider:"yandex#search"}),o=new ymaps.ObjectManager({clusterize:!0,gridSize:32,clusterDisableClickZoom:!0,clusterOpenBalloonOnClick:!1});o.objects.options.set("preset","islands#greenDotIcon"),o.clusters.options.set("preset","islands#greenClusterIcons"),e.geoObjects.add(o),o.add(t),o.objects.events.add(["click"],(function(e){var t=e.get("objectId");if("click"==e.get("type")){let e=$("#map").css("width");$("#map").css("height"),$("#map-block").length&&$("#map-block").remove();let l=$("#map").offset(),o=$('<div class="alert-message m-3 p-2" id="map-block" style="position: absolute; background: white; border: 1px solid silver">Хотите выбрать этот пункт? <br> <div class="d-flex justify-content-around my-2"><a href="#" class="btn btn-danger btn-sm mx-2" id="map-yes">Да</a><a href="#" class="btn btn-secondary btn-sm mx-2" id="map-no">Нет, другой</a></div></div>'),c=$('<div class="alert-message m-3 p-2 container align-items-center rounded-bottom" id="map-input" style="background: white"><div class="d-flex w-100 flex-wrap justify-content-center mt-2"><p class="w-100 text-center"><small>Заполните данные для доставки</small></p><p class="w-100 text-center error-info-block" style="color: red"></p><input class="form-control w-50 my-1 mx-3 phone-input"  required type="phone" placeholder="Телефон.."><br><input class="form-control my-1 mx-3 w-50 f-name" type="text" required  placeholder="Ф.И.О."><br></div><div class="d-flex flex-wrap justify-content-center"><a href="#" class="btn btn-warning btn-sm mt-2 mb-1 call-ajax ">Подтвердить</a><br><a href="#" class="text-muted w-100 text-center " style="text-decoration: none;"><small class="cancel-btn">Отмена</small></a></div></div>');$("#map").append(o),$(o).offset({top:l.top,left:l.left}),$("#map-yes").on("click",(function(){$(o).remove(),$("#map").append(c),$(c).offset({top:l.top,left:l.left}),$(c).css("width",e),null!=n&&$(".phone-input").val(n),$(".cancel-btn").on("click",(function(){$(c).remove()})),$(".call-ajax").on("click",(function(){if($(".f-name").val()&&$(".phone-input").val()){$("#full-name-delivery").val($(".f-name").val()),$("#phone-delivery").val($(".phone-input").val()),$("#street-delivery").val(i[t].address);const e=$("#order-delivery-main-form")[0],n=$(e).attr("action"),l=$.post(n,$(e).serialize());l.done((function(e){console.log("Формочка успешно ушла")})),l.fail((function(e){console.log("Ошибка где то кроется")}))}else $(".error-info-block").append("<small>Для того что бы продлолжить, необходимо заполнить все поля</small>")}))})),$("#map-no").on("click",(function(){$(o).remove()})),$(window).on("resize",(function(){let e=$("#map").offset();$(o).length&&$(o).offset({top:e.top,left:e.left}),$(c).length&&$(c).offset({top:e.top,left:e.left})}))}else o.objects.setObjectOptions(t,{preset:"islands#greenIcon"})}))}))}if($(f).hide(),$(r).on("input",(function(e){$(this).val().length>6?($(this).css("border","1px solid red"),$(s).text("Индекс должен состоять из 6 цифр"),$(s).css("color","red")):($(this).css("border",a),$(s).text(d),$(s).css("color","black")),6==$(this).val().length?$(u).attr("style","display: block"):$(u).attr("style","display: none")})),$(u).on("click",(function(e){e.preventDefault();const t=$(c).find("form")[0];let n=$(t).attr("action");const i=$.post(n,$(t).serialize());i.done((function(e){$(c).hide("fast"),$(f).show("slow");let t=e.pochta,n=e.cdek,i=e.full_cdek,l=null,o=$("#cdek-price").text()+" руб.",r=$("#pochta-price").text()+" руб.";if($("#take-phone").length&&($("#phone-delivery").val($("#take-phone").text()),l=$("#take-phone").text()),t.city&&i.length)$("#region-delivery").val(t.region),$("#city-delivery").val(t.city),$("#index-delivery").val(t.index),p(0,n,l,i);else if(t.city)$("#radio-dek").remove(),$("#block-1").remove(),$("#radio-pochta").remove(),$("#block-2").fadeIn(),$("#region-delivery").val(t.region),$("#city-delivery").val(t.city),$("#index-delivery").val(t.index),$("#delivery-name").val(2),$("#delivery_price").text("+ стоимость доставки: "+r),null!=l&&$("#phone-delivery").val(l),console.log("Есть только почта");else if(i.length)$("#region-delivery").val(i[0].region),$("#city-delivery").val(i[0].city),$("#index-delivery").val(i[0].index),p(0,n,l,i),console.log("Есть только сдек");else{$("#radio-dek").remove(),$("#block-1").remove(),$("#radio-pochta").remove(),$("#block-2").fadeIn(),$(".label-in-pochta-block").remove(),null!=l&&$("#phone-delivery").val(l);let e=$('<div><p class=""><span style="color: red">Похоже на ошибку.</span> Возможно не правильно передан <b>индекс</b> или ошибки на стороне сайта. Пожалуйства, обновите страницу и попробуйте еще раз, если результат такой же, то на данный момент доступно только ручное указание данных для отправления..</p><p><span class="badge rounded-pill bg-warning text-dark mt-3 me-2">1</span><span>Укажите спопоб отправки</span></div></p><p><label><input type="radio" name="radi" value="1" required>CDEK</label><br>\n<label><input type="radio" name="radi" value="2">Почта России</label><br>\n</p><p><span class="badge rounded-pill bg-warning text-dark mt-3 me-2">2</span><span>Заполните форму</span></div></p><p class="text-muted"><small>Если вы выбрали CDEK, то в поле "Улица" укажите желаемый пункт выдачи в вашем городе, в случае выробора "Почта России" указывать следует ваш адрес</small></p></div>');$("#order-delivery-main-form").before(e),$('input[name="radi"]').click((function(){$("#delivery-name").val($(this).val()),2==$(this).val()&&$("#delivery_price").text("+ стоимость доставки: "+r),1==$(this).val()&&$("#delivery_price").text("+ стоимость доставки: "+o)})),console.log("Нет данных ни по сдеку ни по почте")}})),i.fail((function(e){console.log("Что то не так"),console.log(e)}))})),$("#main-form-btn").click((function(e){const t=$("#order-delivery-main-form")[0],n=$(t).attr("action");if($('input[name="radi"]').length&&!$('input[name="radi"]').is(":checked")){e.preventDefault();let t=$('input[name="radi"]')[0],n=$('<div class="alert alert-warning alert-dismissible fade show" role="alert">\n<strong>выберете способ доставки</strong></div>');return $(t).before(n),void setTimeout((function(){$(n).remove()}),2e3)}const i=$.post(n,$(t).serialize());i.done((function(e){})),i.fail((function(e){}))})),$('input[name="radio"]').click((function(){let e=$("#cdek-price").text()+" руб.",t=$("#pochta-price").text()+" руб.",n=$("#block-"+$(this).val());$("#delivery-name").val($(this).val()),2==$(this).val()&&$("#delivery_price").text("+ стоимость доставки: "+t),1==$(this).val()&&$("#delivery_price").text("+ стоимость доставки: "+e),$(".block-text-delivery").not(n).hide(0),n.fadeIn(500)})),$("#button-up").click((function(e){return e.preventDefault(),$("body,html").animate({scrollTop:0},500),!1})),$(".breadcrumbs-div").length){let e=$(".breadcrumbs-div").next("div.border-bottom").next();$(e).height()<$(window).height()/1.8&&$(e).height($(window).height()/2.2)}else if($(".news-block").length){let e=$(".news-block").next();$(e).height()<$(window).height()/1.8&&$(e).height($(window).height()/2.2)}else{let e=$(".burger-muted-background").next();$(e).height()<$(window).height()/1.8&&$(e).height($(window).height()/2.2)}}));